# Attempting to fix 256 color issues with fbterm.
case "$TERM" in
  xterm*)
    export TERM=xterm-256color
    ;;
  linux)
    export TERM=fbterm
    ;;
esac

export PATH="$HOME/emacs/src:$PATH:$HOME/bin:$HOME/.local/bin:$HOME/dotfiles/utils"
export ANDROID_HOME=$HOME/Android/Sdk
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/platform-tools
export PATH="$HOME/.cargo/bin:$PATH" # Add rust binaries.
export PATH="$HOME/py3env/bin:$PATH" # Add py3env.
export PATH="$HOME/.emacs.d/bin:$PATH" # Add doom binary.

source ~/antigen.zsh

antigen use oh-my-zsh
antigen bundles <<EOBUNDLES
git
command-not-found
colored-man-pages

djui/alias-tips

zsh-users/zsh-autosuggestions
zsh-users/zsh-completions
rupa/z
vi-mode
zdharma/fast-syntax-highlighting
EOBUNDLES

SAVEHIST=1000000000 # Number of entries
HISTSIZE=1000000000
HISTFILE=~/.zsh_history # File
setopt APPEND_HISTORY # Don't erase history
setopt EXTENDED_HISTORY # Add additional data to history like timestamp
setopt INC_APPEND_HISTORY # Add immediately
setopt HIST_FIND_NO_DUPS # Don't show duplicates in search
setopt NO_HIST_BEEP # Don't beep
setopt SHARE_HISTORY # Share history between session/terminals

# Setup theme.
antigen theme bhilburn/powerlevel9k
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(context dir_writable dir vcs)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(vi_mode status command_execution_time root_indicator background_jobs time)
POWERLEVEL9K_HOME_FOLDER_ABBREVIATION="•"
POWERLEVEL9K_VI_INSERT_MODE_STRING=""
POWERLEVEL9K_VI_COMMAND_MODE_STRING="✱"
POWERLEVEL9K_STATUS_OK=false

POWERLEVEL9K_COLOR_SCHEME='light'

POWERLEVEL9K_VCS_CLEAN_BACKGROUND='none'
POWERLEVEL9K_VCS_CLEAN_FOREGROUND='076'
POWERLEVEL9K_VCS_UNTRACKED_BACKGROUND='none'
POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND='red'
POWERLEVEL9K_VCS_MODIFIED_BACKGROUND='none'
POWERLEVEL9K_VCS_MODIFIED_FOREGROUND='180'
POWERLEVEL9K_TIME_BACKGROUND='none'
POWERLEVEL9K_TIME_FOREGROUND='246'
POWERLEVEL9K_DIR_DEFAULT_BACKGROUND='none'
POWERLEVEL9K_DIR_DEFAULT_FOREGROUND='246'
POWERLEVEL9K_DIR_HOME_BACKGROUND='none'
POWERLEVEL9K_DIR_HOME_FOREGROUND='246'
POWERLEVEL9K_DIR_HOME_SUBFOLDER_BACKGROUND='none'
POWERLEVEL9K_DIR_HOME_SUBFOLDER_FOREGROUND='246'
POWERLEVEL9K_COMMAND_EXECUTION_TIME_FOREGROUND='233'
POWERLEVEL9K_COMMAND_EXECUTION_TIME_BACKGROUND='172'
POWERLEVEL9K_VI_MODE_INSERT_BACKGROUND='none'
POWERLEVEL9K_VI_MODE_NORMAL_BACKGROUND='none'


POWERLEVEL9K_LEFT_SEGMENT_SEPARATOR=""
POWERLEVEL9K_RIGHT_SEGMENT_SEPARATOR=""
POWERLEVEL9K_LEFT_SUBSEGMENT_SEPARATOR=""
POWERLEVEL9K_RIGHT_SUBSEGMENT_SEPARATOR=""

# TODO: Setup appropriate syntax highlight styles for light background.
# https://github.com/zdharma/fast-syntax-highlighting/issues/49

DEFAULT_USER=`whoami`

antigen apply

# zsh-autosuggestions config
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=246'

# vi-mode: reduce normal-mode-switch delay.
export KEYTIMEOUT=1

# Send commands to copyq
preexec() copyq tab "&zsh" insert 0 $1

# Enable fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
# Setup fzf and its util functions
source ~/dotfiles/zsh/fzf.zsh

# Enable fasd
eval "$(fasd --init auto)"
alias v="f -e vim"

# Override environment variables
export BROWSER="w3m"
export EDITOR="vim"
export VISUAL="vim"

# Setup vi text objects for older versions of the shell.
if [[ $(zsh --version | awk '{print $2}') < 5.0.8 ]]; then
  echo "Older version of zsh, sourcing opp.sh for vi text objects."
  pd=`pwd`
  cd $HOME
  if [[ ! -e "opp.zsh" ]]; then
    git clone https://github.com/hchbaw/opp.zsh
  fi
  cd opp.zsh
  git pull origin master
  source opp.zsh
  source opp/*.zsh
  cd $pd
fi

# Aliases
alias apps='sudo /usr/bin/software-center'
alias c=clear
alias l='ls -alrt'
alias d='$HOME/dotfiles/do'
alias g=googler
alias h='$HOME/py3env/bin/howdoi -n 3 -c'
alias today='~/pyenv/bin/gcalcli agenda now 11:59pm --calendar $CALENDAR --detail_location --detail_description'
alias week='~/pyenv/bin/gcalcli agenda --calendar $CALENDAR'
alias weeknum='date +%V'
alias i='sudo inxi -v 7'
alias dupes='fdupes -r -n -A -d'

# Keybindings
bindkey '^w' forward-word
bindkey '^b' backward-word
# bindkey '^B' push-line-or-edit

# Append googler autocompletions to fpath
fpath=($HOME/googler/auto-completion/zsh $fpath)

# Load auto-completions
autoload -U compinit && compinit
zstyle ':completion:*' menu select
zmodload zsh/complist

# use the vi navigation keys in menu completion
bindkey -M menuselect '^h' vi-backward-char
bindkey -M menuselect '^k' vi-up-line-or-history
bindkey -M menuselect '^l' vi-forward-char
bindkey -M menuselect '^j' vi-down-line-or-history

# For android studio
export _JAVA_AWT_WM_NONREPARENTING=1

# Finally, source any local config.
if [[ -x "$HOME/.zshrc.local" ]]
then
    source ~/.zshrc.local
fi
