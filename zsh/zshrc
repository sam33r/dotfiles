# Attempting to fix 256 color issues with fbterm.
case "$TERM" in
  xterm*)
    export TERM=xterm-256color
    ;;
  linux)
    export TERM=fbterm
    ;;
esac

export PATH="$HOME/emacs/src:$PATH:$HOME/bin:$HOME/.local/bin:$HOME/dotfiles/utils"
export ANDROID_HOME=$HOME/Android/Sdk
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/platform-tools

source ~/antigen.zsh

antigen use oh-my-zsh
antigen bundles <<EOBUNDLES
git
command-not-found
colored-man-pages

djui/alias-tips

zsh-users/zsh-autosuggestions
zsh-users/zsh-completions
zsh-users/zsh-syntax-highlighting
rupa/z
vi-mode
EOBUNDLES

# Setup theme.
antigen theme bhilburn/powerlevel9k
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(context dir_writable dir rbenv vcs)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(vi_mode status command_execution_time root_indicator background_jobs battery time)

antigen apply

# zsh-autosuggestions config
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=white'

# vi-mode: reduce normal-mode-switch delay.
export KEYTIMEOUT=1

# Send commands to copyq
preexec() copyq tab "&zsh" insert 0 $1

# Enable fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
# Setup fzf and its util functions
source ~/dotfiles/zsh/fzf.zsh

# Enable fasd
eval "$(fasd --init auto)"
alias v="f -e vim"

# Override environment variables
export BROWSER="w3m"
export EDITOR="vim"
export VISUAL="vim"

# Setup vi text objects for older versions of the shell.
if [[ $(zsh --version | awk '{print $2}') < 5.0.8 ]]; then
  echo "Older version of zsh, sourcing opp.sh for vi text objects."
  pd=`pwd`
  cd $HOME
  if [[ ! -e "opp.zsh" ]]; then
    git clone https://github.com/hchbaw/opp.zsh
  fi
  cd opp.zsh
  git pull origin master
  source opp.zsh
  source opp/*.zsh
  cd $pd
fi

# Aliases
alias apps='sudo /usr/bin/software-center'
alias c=clear
alias d='$HOME/dotfiles/do'
alias g=googler
alias h='$HOME/pyenv/bin/howdoi -n 3 -c'
alias today='~/pyenv/bin/gcalcli agenda now 11:59pm --calendar $CALENDAR --detail_location --detail_description'
alias week='~/pyenv/bin/gcalcli agenda --calendar $CALENDAR'
alias weeknum='date +%V'
alias i='inxi -V'
alias dupes='fdupes -r -n -A -d'

# Keybindings
bindkey '^w' forward-word
bindkey '^b' backward-word
# bindkey '^B' push-line-or-edit

# Append googler autocompletions to fpath
fpath=($HOME/googler/auto-completion/zsh $fpath)

# Load auto-completions
autoload -U compinit && compinit
zstyle ':completion:*' menu select
zmodload zsh/complist

# use the vi navigation keys in menu completion
bindkey -M menuselect '^h' vi-backward-char
bindkey -M menuselect '^k' vi-up-line-or-history
bindkey -M menuselect '^l' vi-forward-char
bindkey -M menuselect '^j' vi-down-line-or-history

# For android studio
export _JAVA_AWT_WM_NONREPARENTING=1

# Finally, source any local config.
if [[ -x "$HOME/.zshrc.local" ]]
then
    source ~/.zshrc.local
fi
